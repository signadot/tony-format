// Code generated by tony-codegen. DO NOT EDIT.

package api

import (
	"bytes"
	"fmt"

	"github.com/signadot/tony-format/go-tony/encode"
	"github.com/signadot/tony-format/go-tony/ir"
	"github.com/signadot/tony-format/go-tony/parse"
)

// ToTonyIR converts RequestBody to a Tony IR node.
func (s *RequestBody) ToTonyIR(opts ...encode.EncodeOption) (*ir.Node, error) {
	// Create IR object map
	irMap := make(map[string]*ir.Node)

	// Field: Path (string)
	if s.Path != "" {
		irMap["path"] = ir.FromString(s.Path)
	}

	// Field: Match (optional *ir.Node)
	if s.Match != nil {
		irMap["match"] = s.Match
	}

	// Field: Patch (optional *ir.Node)
	if s.Patch != nil {
		irMap["patch"] = s.Patch
	}

	// Field: Meta (optional map[string]*ir.Node)
	if s.Meta != nil {
		irMap["meta"] = ir.FromMap(s.Meta)
	}

	// Create IR node with schema tag
	return ir.FromMap(irMap).WithTag("!request_body"), nil
}

// FromTonyIR populates RequestBody from a Tony IR node.
func (s *RequestBody) FromTonyIR(node *ir.Node, opts ...parse.ParseOption) error {
	// Validate IR node type
	if node.Type != ir.ObjectType {
		return fmt.Errorf("expected object type, got %v", node.Type)
	}

	for i, fieldName := range node.Fields {
		fieldNode := node.Values[i]
		switch fieldName.String {
		case "path":
			// Field: Path (string)
			if fieldNode.Type != ir.StringType {
				return fmt.Errorf("field %q: expected string, got %v", "path", fieldNode.Type)
			}
			s.Path = fieldNode.String
		case "match":
			// Field: Match (*ir.Node)
			s.Match = fieldNode
		case "patch":
			// Field: Patch (*ir.Node)
			s.Patch = fieldNode
		case "meta":
			// Field: Meta (map[string]*ir.Node)
			if fieldNode.Type != ir.ObjectType {
				return fmt.Errorf("field %q: expected object, got %v", "meta", fieldNode.Type)
			}
			s.Meta = ir.ToMap(fieldNode)
		}
	}

	return nil
}

// ToTony converts RequestBody to Tony format bytes.
func (s *RequestBody) ToTony(opts ...encode.EncodeOption) ([]byte, error) {
	node, err := s.ToTonyIR(opts...)
	if err != nil {
		return nil, err
	}
	var buf bytes.Buffer
	if err := encode.Encode(node, &buf, opts...); err != nil {
		return nil, err
	}
	return buf.Bytes(), nil
}

// FromTony parses Tony format bytes and populates RequestBody.
func (s *RequestBody) FromTony(data []byte, opts ...parse.ParseOption) error {
	node, err := parse.Parse(data, opts...)
	if err != nil {
		return err
	}
	return s.FromTonyIR(node, opts...)
}
