<!-- Comment 001 - 2025-12-21T04:04:17+01:00 -->

## Array operations and memory constraints

`!arraydiff` with positional indices is problematic for streaming:
- Insert at index 0 requires shifting all subsequent elements
- Applying requires buffering the array or tracking positions
- Breaks out-of-memory streaming goal

Streaming-safe alternatives:
- `!key(id)` - identity-based matching, can stream and apply when key matches
- `!append` - add to end, no position knowledge needed (not a mergeop yet)

For logd's streaming patch processor, supporting `!arraydiff` would require materializing arrays in memory. Need to decide:
1. Restrict to streaming-safe ops only?
2. Support `!arraydiff` with memory cost for that case?
3. Introduce `!append` as a first-class streaming-friendly operation?

This ties into the broader question of what array semantics the API should expose.

