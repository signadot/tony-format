<!-- Comment 001 - 2025-12-24T03:49:14+01:00 -->

## Design: gomap Comment Options

Comments can occur anywhere in IR, not just object field values. The fix requires proper comment options in gomap.

### Proposed Options

```go
// MapComments controls whether comments are included when mapping to IR.
// When true, fields with tony:"comment" / tony:"line-comment" directives
// generate comment nodes in output.
func MapComments(v bool) MapOption

// UnmapComments controls whether comments are preserved during unmapping.
// When true, CommentType wrappers are preserved in *ir.Node fields and
// comment/line-comment tagged fields are populated.
func UnmapComments(v bool) UnmapOption
```

### Option Translation

gomap options are the high-level API that translates to lower-level options:

```
MapOption    → EncodeOption   (gomap.MapComments → encode.EncodeComments)
UnmapOption  → ParseOption    (gomap.UnmapComments → parse.ParseComments)
```

Using existing helpers:
```go
func ToEncodeOptions(opts ...MapOption) []encode.EncodeOption
func ToParseOptions(opts ...UnmapOption) []parse.ParseOption
```

### Generated Code Fix

For type checking, always unwrap comments:
```go
innerNode := fieldNode
if innerNode.Type == ir.CommentType && len(innerNode.Values) > 0 {
    innerNode = innerNode.Values[0]
}
if innerNode.Type == ir.ObjectType {
    // ... decode using innerNode
}
```

For `*ir.Node` assignment, respect the option:
```go
if unmapComments {
    s.Field = fieldNode  // preserve wrapper
} else {
    s.Field = innerNode  // stripped
}
```

This applies everywhere comments can occur: object field values, array elements, map values, etc.

