<!-- Comment 006 - 2025-12-20T11:07:14+01:00 -->

## The Tony IR Rock (docs/ir.md)

The IR is a simple recursive intermediate representation, itself representable in JSON/YAML/Tony.

### Node Types (tagged union)
- **Object**: `.fields[i]` is key for `.values[i]` (same length)
- **Array**: `.values` contains elements
- **String**: canonical in `.string`, optional `.lines` for folding
- **Number**: `.int` (64-bit signed), `.float` (64-bit IEEE), or `.number` (string fallback)
- **Bool**: `.bool`
- **Null**: no additional fields
- **Comment**: `.lines` contains comment text

### Key Constraints
- Object fields: string (not multiline), int (uint32), or null (merge key)
- Objects have all int keys OR all non-int keys (not mixed)
- No position information - IR is purely semantic

### Comment Association
1. Head comment: Comment node with 1 element in `.values`
2. Line comment: Comment node in `.comment` field of non-comment node
3. Trailing comments: appended to root node's `.comment.lines`

### Example
```tony
!head-tag
# comment
field: # field comment
  - 1
  - !two-tag two
---
# IR structure
type: Object
fields:
- type: String
  string: field
values:
- type: Array
  values:
  - type: Number
    int: 1
tag: "!head-tag"
comment:
  type: Comment
  lines:
  - ""
  - "# comment"
```
